import{r,j as e,c as q,R}from"./client-DD4c7S6m.js";const T=r.createContext(null),l=({children:t})=>{const[s,n]=r.useState(!1),o=()=>n(c=>!c);return e.jsx(T.Provider,{value:{isShow:s,toggleView:o},children:t})},v=()=>{const t=r.useContext(T);if(!t)throw new Error("useViewToggleContext must be used within a ViewToggle");return t},I=({children:t})=>{const{isShow:s}=v();return!s&&t},E=({children:t})=>{const{isShow:s}=v();return s&&t},M=({children:t,handleClick:s,...n})=>{const{toggleView:o,isShow:c}=v(),a=typeof t=="function"?t(c):t;return e.jsx("button",{onClick:()=>{s==null||s(),o()},...n,children:a})};l.Trigger=M;l.OnShow=E;l.OnHide=I;const C=t=>{const[s,n]=r.useState(t);return{formValues:s,handleFormChange:a=>{const{name:d,value:i}=a.target;n(m=>({...m,[d]:i}))},handleFormReset:()=>{n(t)}}},$=t=>{const[s,n]=r.useState(t),o=r.useCallback(a=>{n(d=>d.map(i=>i.id===a.id?a:i))},[]),c=r.useCallback(a=>{n(d=>[...d,a])},[]);return{products:s,updateProduct:o,addProduct:c}},k=r.createContext(null),O=({children:t,initialProducts:s})=>{const n=$(s);return e.jsx(k.Provider,{value:n,children:t})},g=()=>{const t=r.useContext(k);if(!t)throw new Error("useProductContext must be used within ProductProvider");return t},b=t=>e.jsx("input",{type:"text",...t,className:"w-full p-2 border rounded"}),L=()=>{const{addProduct:t}=g(),{formValues:s,handleFormChange:n,handleFormReset:o}=C({name:"",price:0,stock:0,discounts:[]}),c=()=>{const a=Date.now().toString();t({...s,id:a}),o()};return e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx(b,{id:"productName",value:s.name,name:"name",onChange:n,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx(b,{id:"productPrice",type:"number",value:s.price,name:"price",onChange:n,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx(b,{id:"productStock",type:"number",value:s.stock,name:"stock",onChange:n,className:"w-full p-2 border rounded"})]}),e.jsx(l.Trigger,{handleClick:c,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]})},B=()=>e.jsxs(l,{children:[e.jsx(l.Trigger,{className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:t=>t?"취소":"새 상품 추가"}),e.jsx(l.OnShow,{children:e.jsx(L,{})})]}),Q=t=>{const[s,n]=r.useState(t),o=r.useCallback(c=>{n(a=>[...a,c])},[]);return{coupons:s,addCoupon:o}},D=r.createContext(null),H=({children:t,initialCoupons:s})=>{const n=Q(s);return e.jsx(D.Provider,{value:n,children:t})},y=()=>{const t=r.useContext(D);if(!t)throw new Error("useCouponContext must be used within CouponProvider");return t},U=()=>{const{coupons:t}=y();return e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:t.map((s,n)=>e.jsxs("div",{"data-testid":`coupon-${n+1}`,className:"bg-gray-100 p-2 rounded",children:[s.name," (",s.code,"):",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," ","할인"]},n))})]})},_=()=>{const{addCoupon:t}=y(),{formValues:s,handleFormChange:n,handleFormReset:o}=C({name:"",code:"",discountType:"percentage",discountValue:0}),c=()=>{t({...s}),o()};return e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx(b,{name:"name",placeholder:"쿠폰 이름",value:s.name,onChange:n}),e.jsx(b,{name:"code",placeholder:"쿠폰 코드",value:s.code,onChange:n}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:s.discountType,name:"discountType",onChange:n,className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx(b,{type:"number",name:"discountValue",placeholder:"할인 값",value:s.discountValue,onChange:n})]}),e.jsx("button",{onClick:c,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]})},z=()=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx(_,{}),e.jsx(U,{})]})]}),G=t=>{const[s,n]=r.useState(t);return{discounts:s,addDiscount:a=>{n(d=>[...d,a])},removeDiscount:a=>{n(d=>d.filter((i,m)=>m!==a))}}},f={quantity:0,rate:0},J=({product:t})=>{const{updateProduct:s}=g(),{handleFormChange:n,formValues:o,handleFormReset:c}=C(t),{discounts:a,addDiscount:d,removeDiscount:i}=G(t.discounts),[m,u]=r.useState(f),x=()=>{s({...o,discounts:a}),c()},h=()=>{d(m),u(f)},N=p=>{i(p)};return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",name:"name",value:o.name,onChange:n,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:o.price,name:"price",onChange:n,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",name:"stock",value:o.stock,onChange:n,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),a.map((p,w)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[p.quantity,"개 이상 구매 시 ",p.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>N(w),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},w)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:m.quantity,onChange:p=>u({...m,quantity:parseInt(p.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:m.rate*100,onChange:p=>u({...m,rate:parseInt(p.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:h,className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx(l.Trigger,{handleClick:x,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]})},K=({product:t})=>e.jsxs("div",{children:[t.discounts.map((s,n)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[s.quantity,"개 이상 구매 시 ",s.rate*100,"% 할인"]})},n)),e.jsx(l.Trigger,{"data-testid":"modify-button",className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]}),W=({product:t})=>e.jsxs(l,{children:[e.jsx(l.OnShow,{children:e.jsx(J,{product:t})}),e.jsx(l.OnHide,{children:e.jsx(K,{product:t})})]}),X=({product:t,...s})=>e.jsx("div",{className:"bg-white p-4 rounded shadow",...s,children:e.jsxs(l,{children:[e.jsxs(l.Trigger,{"data-testid":"toggle-button",className:"w-full text-left font-semibold",children:[t.name," - ",t.price,"원 (재고: ",t.stock,")"]}),e.jsx(l.OnShow,{children:e.jsx("div",{className:"mt-2",children:e.jsx(W,{product:t})})})]})}),Y=({})=>{const{products:t}=g();return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx(B,{}),e.jsx("div",{className:"space-y-2",children:t.map((s,n)=>e.jsx(X,{"data-testid":`product-${n+1}`,product:s},s.id))})]})},Z=()=>e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Y,{}),e.jsx(z,{})]})]}),ee=(t,s)=>{switch(s.discountType){case"amount":return Math.max(0,t-s.discountValue);case"percentage":return t*(1-s.discountValue/100)}},te=t=>{const s=F(t);return t.quantity*t.product.price*(1-s)},F=t=>{const s=t.product.discounts.filter(o=>t.quantity>=o.quantity).map(o=>o.rate);return Math.max(...s,0)},se=(t,s)=>{const n=t.reduce((d,i)=>d+i.quantity*i.product.price,0),o=t.reduce((d,i)=>d+te(i),0),c=s?ee(o,s):o,a=n-c;return{totalBeforeDiscount:n,totalAfterDiscount:c,totalDiscount:a}},S=(t,s,n)=>n<=0?t.filter(o=>o.product.id!==s):t.map(o=>o.product.id===s?{...o,quantity:Math.min(o.product.stock,n)}:o),ne=()=>{const[t,s]=r.useState([]),[n,o]=r.useState(null);return{cart:t,addToCart:u=>{s(x=>{const h=x.find(N=>N.product.id===u.id);return h?S(x,u.id,h.quantity+1):[...x,{product:u,quantity:1}]})},removeFromCart:u=>{s(x=>x.filter(h=>h.product.id!==u))},updateQuantity:(u,x)=>{s(h=>S(h,u,x))},applyCoupon:u=>{o(u)},calculateTotal:()=>se(t,n),selectedCoupon:n}},V=r.createContext(null),oe=({children:t})=>{const s=ne();return e.jsx(V.Provider,{value:s,children:t})},j=()=>{const t=r.useContext(V);if(!t)throw new Error("useCartContext must be used within CartProvider");return t},P=({label:t,step:s,item:n})=>{const{updateQuantity:o}=j();return e.jsx("button",{onClick:()=>o(n.product.id,n.quantity+s),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:t})},ae=({item:t})=>{const{removeFromCart:s}=j();return e.jsx("button",{onClick:()=>s(t.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})},ce=({item:t})=>{const s=F(t);return e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price,"원 x ",t.quantity,s>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(s*100).toFixed(0),"% 할인 적용)"]})]})]})},re=({item:t})=>e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsx(ce,{item:t}),e.jsxs("div",{children:[e.jsx(P,{label:"-",step:-1,item:t}),e.jsx(P,{label:"+",step:1,item:t}),e.jsx(ae,{item:t})]})]}),de=()=>{const{cart:t}=j();return e.jsx("div",{className:"space-y-2",children:t.map(s=>e.jsx(re,{item:s},s.product.id))})},le=()=>{const{coupons:t}=y(),{applyCoupon:s}=j();return e.jsxs("select",{onChange:n=>s(t[parseInt(n.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),t.map((n,o)=>e.jsxs("option",{value:o,children:[n.name," -"," ",n.discountType==="amount"?`${n.discountValue}원`:`${n.discountValue}%`]},n.code))]})},ie=()=>{const{selectedCoupon:t}=j();return t&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",t.name,"(",t.discountType==="amount"?`${t.discountValue}원`:`${t.discountValue}%`," ","할인)"]})},ue=()=>e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsx(le,{}),e.jsx(ie,{})]}),me=()=>{const{calculateTotal:t}=j(),{totalBeforeDiscount:s,totalAfterDiscount:n,totalDiscount:o}=t();return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",s.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",o.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",n.toLocaleString(),"원"]})]})]})},A=(t,s)=>{const n=s.find(o=>o.product.id===t.id);return t.stock-((n==null?void 0:n.quantity)||0)},xe=({product:t,...s})=>{const{addToCart:n,cart:o}=j(),a=A(t,o)<=0;return e.jsx("button",{onClick:()=>n(t),className:`w-full px-3 py-1 rounded ${a?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,disabled:a,...s,children:a?"품절":"장바구니에 추가"})},he=({product:t})=>t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((s,n)=>e.jsxs("li",{children:[s.quantity,"개 이상: ",(s.rate*100).toFixed(0),"% 할인"]},n))}),pe=({product:t})=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[t.price.toLocaleString(),"원"]})]}),je=t=>t.reduce((s,n)=>Math.max(s,n.rate),0),be=({product:t})=>{const{cart:s}=j(),n=A(t,s),o=(je(t.discounts)*100).toFixed(0);return e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${n>0?"text-green-600":"text-red-600"}`,children:["재고: ",n,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",o,"% 할인"]})]})},ge=({product:t})=>e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsx(pe,{product:t}),e.jsx(be,{product:t}),e.jsx(he,{product:t}),e.jsx(xe,{product:t})]}),Ne=()=>{const{products:t}=g();return e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(s=>e.jsx(ge,{product:s},s.id))})]})},ve=()=>e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Ne,{}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx(de,{}),e.jsx(ue,{}),e.jsx(me,{})]})]})]}),Ce=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],ye=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],we=()=>{const[t,s]=r.useState(!1);return e.jsx(O,{initialProducts:ye,children:e.jsx(H,{initialCoupons:Ce,children:e.jsx(oe,{children:e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>s(!t),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:t?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:t?e.jsx(Z,{}):e.jsx(ve,{})})]})})})})};q.createRoot(document.getElementById("root")).render(e.jsx(R.StrictMode,{children:e.jsx(we,{})}));
